##
## This file is managed by Ansible.  ALL CHANGES WILL BE OVERWRITTEN.
##
#
# See 'perldoc Mail::SpamAssassin::Conf' for details of what can be
# tweaked.
#
###########################################################################

# trusted_networks are IPs of MTAs that may *relay* spam but that we trust not
# to *originate* spam. Trust all of PSU's network range since there's no real
# way to know what addresses ITS will relay from. This is necessary because of
# the bx.psu.edu -> galaxyproject.org forwards relaying through smtp.psu.edu.
# If BX's MXs relayed directly this wouldn't be necessary.
trusted_networks 128.118.0.0/16
trusted_networks 146.186.0.0/16

# BX's IPv6 MTAs
trusted_networks 2610:8:6800:45::2
trusted_networks 2610:8:6800:45::3
trusted_networks 2610:8:6800:45::4
trusted_networks 2610:8:6800:4b::2
trusted_networks 2610:8:6800:4b::3
trusted_networks 2610:8:6800:4b::4

# Galaxy MTAs
trusted_networks 54.172.110.33
trusted_networks 54.172.173.123

# Galaxy MTA internal IPs
trusted_networks 172.30.0.0/23
trusted_networks 127.0.0.1

# Spamhaus CSS was detecting messages but for some reason, despite finding some
# mentions to this test existing, I can't find it, so I define it here.

# CSS is the Spamhaus Snowshoe: http://www.spamhaus.org/css/
header RCVD_IN_CSS              eval:check_rbl_sub('zen', '127.0.0.3')
describe RCVD_IN_CSS            Received via a relay in Spamhaus CSS
tflags RCVD_IN_CSS              net
reuse  RCVD_IN_CSS
score RCVD_IN_CSS 0 2.596 0 0.141 # n=0 n=2

# Whitelist mail sent as galaxy-bugs that originates at TACC
whitelist_from_rcvd galaxy-bugs@bx.psu.edu irongate.mail.utexas.edu

# Blacklist some TLDs that we are receiving mail from that are unlikely to ever
# originate legitimate mail
blacklist_from *.link
blacklist_from *.red
blacklist_from *.blue

# Score some specific spam messages
body __BODY_1_1 /Note: Any review, retransmission, dissemination or other use of, or/
body __BODY_1_2 /any action in reliance upon, this information by persons or entities/
body __BODY_1_3 /contact the sender and delete the material from any computer./
body __BODY_1_4 /not sold to us or shared by any person or authority/
meta BODY_1_TEST (__BODY_1_1 && __BODY_1_2 && __BODY_1_3 && __BODY_1_4)
score BODY_1_TEST 7.0
describe BODY_1_TEST Fake education conference spam

body __BODY_2_1 /Notice: We hold the complete ownership of the material keeping in/
body __BODY_2_2 /interested party and consequences. Any review, retransmission/
meta BODY_2_TEST (__BODY_2_1 && __BODY_2_2)
score BODY_2_TEST 7.0
describe BODY_2_TEST Fake education conference spam


body __BODY_3_1 /Please be advised: Use of this information or taking action based/
body __BODY_3_2 /review, retransmission, and dissemination, by any person/
meta BODY_3_TEST (__BODY_3_1 && __BODY_3_2)
score BODY_3_TEST 7.0
describe BODY_3_TEST Fake education conference spam
